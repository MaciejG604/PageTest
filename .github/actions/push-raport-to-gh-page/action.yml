name: "Push raport to gh-page"
description: "Used to push a raport file to the gh-page branch for the webiste to be updated"
inputs:
  token:
    description: "Token for pushing"
    required: true

runs:
  using: "composite"
  steps:
    - name: Git Checkout
      uses: actions/checkout@v3
      with:
        ref: jekyll-gh-page
        fetch-depth: 0
        token: ${{ inputs.token }}

    - uses: actions/download-artifact@v3
      with:
        name: raport.md
        path: ~/

    - name: Add the raport to _post dir and push
      shell: bash
      run: |
        if [ -s ~/raport.md ]; then
          echo "The raport file is non-empty."
        
          current_date=$(date "+%Y-%m-%d")
          second_of_day=$(date "+%H3600+%M60+%S" | bc)
          filename="${current_date}-build-result-${second_of_day}.md"
          
          mkdir -p "./_posts"
          cat ~/raport.md > "./_posts/"$filename"
          
          git config --global user.name "GitHub Actions"
          git config --global user.email "mgajek@virtuslab.com"
          
          git add "./_posts/"$filename"
          git commit -m "Upload build raport"
          git push origin jekyll-gh-page
        else
          echo "The raport file is empty."
          exit 0
        fi
    - name: Git Checkout
      uses: actions/checkout@v3